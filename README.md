# Тестовое задание. 1 - изображение

### План по заданию
- [x] Реализовать скрипт для обработки изображения
    - [x] Реализовать скрипт для генерации тестовых данных
- [x] Реализовать 3 тестовые функции для каждого входного значения
- [x] Реализовать функцию отправки метрик в базу данных
- [x] Результат обработки и результаты тестов собрать в json файл
- [x] В txt собрать проекцию на оси изображения

 
### Проект состоит из следующих модулей:
- `data_generator.py` - Создает yaml-файлы с параметрами пятна и создает изображения пятен по этим файлам
- `image_processor.py` - Обрабатывает изображение пятна и возвращает его параметры
- `test_all.py` - Тест функций модуля image_processor
- `conftest.py` - вспомогательный модуль для тестирования
- `metrics_to_DB.py` - Отправляет посчитанные метрики в базу данных с помощью influx DB
- `metrics_to_json.py` - Считает параметры изображений и записывает в файл `image_metrics.json` 
- `projections_to_txt.py` - Считает проекции изображений и записывает в файл `projetions.txt`

## Порядок запуска:
0. Клонировать репозиторий и установить виртуальное окружение в соответствии с `requirements.txt`

#### Генерация данных
В папке `Test Data` собраны yaml-файлы с параметрами тестовых пучков и соответствующие им png-изображения. Если необходимо создать еще тестовые случаи, необходимо воспользоваться скриптом `data_generator.py`:
1. Запустите скрипт `data_generator.py`
2. Вам будет предложено создать новый тест-кейс. В случае согласия будет предложено ввести его название, координаты и размер пучка (стандартное отклонение).
3. Считав параметры, скрипт создаст yaml-файл с введенными параметрами и соответствующее ему изображение
4. Далее будет предложено обновить все изображения в папке `Test Data`. Если все изображения на месте, это можно пропустить

####  Тестирование скрипта обработки
Все тестовые функции находятся в файле `test_all.py`, вспомогательные функции - в файле `conftest.py`
1. В терминале запустите команду `pytest`
   - В силу реализации скрипта обработки, не везде точно определяются размеры пятна, поэтому не все тесты проходят. На данный момент проходят 13 тестов, и не проходят 3
2. По результатам теста будет создан файл `test_results.json` с краткими отчетами по каждому тесту

#### Отправка метрик в базу данных
Доступ к базе influxDB требует создания на локальном хосте организации "1440_test_1_image" и бакета "Bucket_1". При желании эти параметры можно поменять в `metrics_to_DB.py` в переменных `url`, `org` и `bucket` соответственно.
1. Запустите базу данных influxDB
2. Запустите скрипт `metrics_to_DB.py`. Посчитанные метрики всех изображений будут отправлены в базу данных

#### Сохранение метрик в json
1. Запустите скрипт `metrics_to_json.py`. Будет создан файл `image_metrics.json` с посчитанными метриками всех изображений

#### Расчет проекций и сохранение в txt
1. Запустите скрипт `projections_to_txt.py`. Будет создан файл `projetions.txt` с посчитанными проекциями всех изображений
